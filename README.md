# Hackerlab Telegram Bot

Основной бот для проверки функционала: https://t.me/hackerlab_score_bot

Этот проект представляет собой Telegram‑бота, который отслеживает изменения рейтинга пользователей на сайте `hackerlab.pro`. Бот может проверять рейтинг по запросу, добавлять пользователей на регулярный мониторинг, выводить список отслеживаемых пользователей и удалять их из мониторинга. Мониторинг выполняется каждые 10 минут. Для одного чата можно поставить на мониторинг не более 10 пользователей, а разовые проверки ограничены пятью за пять минут.

## Запуск

1. Клонируйте репозиторий и перейдите в директорию проекта:

   ```bash
   git clone https://github.com/S3cS3k3r/hackerlab_bot.git
   cd hackerlab_bot
   ```

2. Создайте файл `.env` в корне проекта и укажите токен вашего бота:

   ```env
   BOT_TOKEN=ваш_токен_бота
   LOG_CHANNEL_ID=id_вашего_канала_для_логов
   ```

3. Соберите и запустите контейнер Docker:

   ```bash
   docker build -t hackerlab_bot .
   docker run -d --restart=unless-stopped --name hackerlab_bot \
     --env-file .env -v hackerlab_bot_data:/data hackerlab_bot
   ```

   По умолчанию база данных хранится в `/data/data.db`. Для сохранения данных между пересборками используйте volume как в примере выше. При необходимости путь можно переопределить через `DB_URL` или `DB_PATH`.

Бот также можно запускать локально без Docker. В этом случае база по умолчанию создаётся в `~/.local/share/hackerlab_bot/data.db`, чтобы не попадать в Git. Для этого установите зависимости (`pip install -r requirements.txt`) и запустите `python bot.py`.

### Логи

Бот отправляет логи только в канал Telegram: действия пользователей, ошибки пользовательских запросов, статус регулярных проверок рейтингов и сообщение о запуске. Укажите `LOG_CHANNEL_ID` (или `LOG_CHANNEL`) и добавьте бота в администраторы канала. В stdout сохраняются только ошибки доставки логов в канал.

## Использование

После запуска бота отправьте команду `/start`. Появится меню с кнопками:

- **Проверка рейтинга** – запросит ник пользователя с hackerlab и вернёт текущий рейтинг без постановки на регулярный мониторинг. Количество таких проверок ограничено: не более 5 за 5 минут для каждого чата.
- **Пользователи на мониторинге** – отображает список пользователей, которых вы добавили на мониторинг.
- **Добавить на мониторинг** – предложит ввести ник пользователя и добавит его на мониторинг. Для одного чата можно отслеживать до 10 пользователей.
- **Удалить с мониторинга** – выводит список отслеживаемых пользователей и ждёт ввода ника для удаления.

Бот проверяет рейтинг всех добавленных пользователей каждые 10 минут и уведомляет в чат о любом изменении рейтинга.

## Структура проекта

- `bot.py` – основной файл бота, реализующий логическую и пользовательскую часть, включая ограничение по количеству проверок и размеру списка.
- `db.py` – инициализация базы данных SQLite и описание моделей.
- `rating_scraper.py` – функция асинхронного получения рейтинга пользователя с сайта `hackerlab.pro`.
- `requirements.txt` – список зависимостей.
- `Dockerfile` – инструкция для сборки Docker‑образа.
- `README.md` – файл с описанием проекта и инструкций по запуску.
- `LICENSE` – лицензия проекта.

## Лицензия

Проект распространяется под лицензией MIT. Полный текст лицензии находится в файле `LICENSE`.
